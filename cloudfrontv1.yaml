AWSTemplateFormatVersion: '2010-09-09'
Description: 'Static website hosting with S3 and CloudFront'
Parameters:
    BucketName: {Type: String, Default: a-proper-bucket-name}
Resources:
    S3Bucket: {Type: 'AWS::S3::Bucket', Properties: {BucketName: null, WebsiteConfiguration: {ErrorDocument: index.html, IndexDocument: index.html}}}
    ReadPolicy: {Type: 'AWS::S3::BucketPolicy', Properties: {Bucket: null, PolicyDocument: {Statement: [{Sid: ListObjectsInBucket, Effect: Allow, Action: ['s3:ListBucket'], Resource: ['arn:aws:s3:::bucket-name']}, {Sid: AllObjectActions, Effect: Allow, Action: 's3:*Object', Resource: ['arn:aws:s3:::bucket-name/*']}]}}}
    CloudFrontOriginAccessIdentity: {Type: 'AWS::CloudFront::CloudFrontOriginAccessIdentity', Properties: {CloudFrontOriginAccessIdentityConfig: {Comment: null}}}
    CloudFrontDistribution: {Type: 'AWS::CloudFront::Distribution', Properties: {DistributionConfig: {CustomErrorResponses: [{ErrorCode: 403, ResponseCode: 404, ResponsePagePath: /index.html}], DefaultCacheBehavior: {AllowedMethods: [GET, HEAD, OPTIONS], CachedMethods: [GET, HEAD, OPTIONS], Compress: true, DefaultTTL: 3600, ForwardedValues: {Cookies: {Forward: none}, QueryString: false}, MaxTTL: 86400, MinTTL: 60, TargetOriginId: s3origin, ViewerProtocolPolicy: allow-all}, DefaultRootObject: /index.html, Enabled: true, HttpVersion: http2, Origins: [{DomainName: null, Id: s3origin, S3OriginConfig: {OriginAccessIdentity: null}}], PriceClass: PriceClass_All}}}
    PublishUser: {Type: 'AWS::IAM::User', Properties: {Policies: [{PolicyName: null, PolicyDocument: {Statement: [{Action: 's3:*', Effect: Allow, Resource: [null, null]}]}}]}}
    PublishCredentials: {Type: 'AWS::IAM::AccessKey', Properties: {UserName: null}}
Outputs:
    Bucket: {Description: 'S3 Bucket Name', Value: null}
    BucketUrl: {Description: 'S3 Bucket Url', Value: null}
    AccessKeyId: {Description: 'S3 Access Key', Value: null}
    AccessKeySecret: {Description: 'S3 Secret Key', Value: null}
    DistributionId: {Description: 'CloudFront Distribution ID', Value: null}
    Domain: {Description: 'Cloudfront Domain', Value: null}
